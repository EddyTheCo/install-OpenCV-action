name: build-OpenCV
inputs:
  version:
    default: '4.8.0'
    type: string
  shell_1:
    default: 'bash'
  build_wasm:
    default: false

outputs:
  Install-Dir:
    value: ${{ runner.temp }}/OpenCV

runs:
  using: "composite"
  steps:

    - uses: actions/checkout@v3
      with:
        repository: opencv/opencv
        ref: ${{ inputs.version }}
        path: 'OpenCV'

    - name: Create build directory
      run:  cmake -E make_directory ${{runner.temp}}/OpenCVbuild
      shell: ${{ inputs.shell_1 }}

    - name: Configure
      if: ${{ !inputs.build_wasm }}
      working-directory: ${{ runner.temp }}/OpenCVbuild
      run: cmake -G Ninja -DCMAKE_BUILD_TYPE="release" -DCPACK_PACKAGE_FILE_NAME='OpenCV-${{ inputs.version }}-v${SEMVER}-${CMAKE_SYSTEM_NAME}_${CMAKE_SYSTEM_VERSION}-${CMAKE_SYSTEM_PROCESSOR}-${CMAKE_CXX_COMPILER_ID}'  -DCMAKE_INSTALL_PREFIX=${{ runner.temp }}/OpenCV  ${{ github.workspace }}/OpenCV
      shell: ${{ inputs.shell_1 }}
    
    - name: Configure-wasm
      if: ${{ inputs.build_wasm }}
      working-directory: ${{ runner.temp }}/OpenCVbuild
      run: cmake -G Ninja -DCMAKE_BUILD_TYPE="release" -DCMAKE_INSTALL_PREFIX=${{ runner.temp }}/OpenCV  ${{ github.workspace }}/OpenCV
      shell: ${{ inputs.shell_1 }}

    - name: Build
      working-directory: ${{ runner.temp }}/OpenCVbuild
      run: cmake --build .
      shell: ${{ inputs.shell_1 }}


    - name: Install
      working-directory: ${{ runner.temp }}/OpenCVbuild
      run: cmake --install .
      shell: ${{ inputs.shell_1 }}


